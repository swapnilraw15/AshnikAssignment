# Ansible Playbook: Deploy Nginx Ingress and "Hello World" Application on Kubernetes

This Ansible playbook automates the deployment of an Nginx Ingress controller and a sample "Hello World" application on a Kubernetes cluster. The playbook also implements TLS termination using a self-signed certificate.

## Table of Contents
- [Requirements](#requirements)
- [Playbook Structure](#playbook-structure)
- [Usage](#usage)
- [Troubleshooting](#troubleshooting)

## Requirements
- **Kubernetes Cluster:** Ensure you have a running Kubernetes cluster.
- **Ansible:** Installed on your local machine or control node.
- **kubectl and Helm:** Available on the machine running the playbook.
- **Access to the Kubernetes Cluster:** Ensure you have cluster admin privileges.

## Playbook Structure

- **`deploy_k8s.yml`:** The main playbook file containing all tasks.
- **`/tmp/hello-world-tls.yaml`:** Temporary manifest file generated by the playbook for deploying the sample application with TLS.

## Usage
1. Create a Ubuntu machine
2. **Install Docker**
   ```bash
   $ sudo apt update
   $ sudo apt install apt-transport-https curl
   $ sudo apt install docker.io
   $ sudo systemctl enable docker
   $ sudo systemctl start docker
   $ docker --version
3. **Install Minikube [amd64]**
   ```bash
   $ curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
   $ sudo install minikube-linux-amd64 /usr/local/bin/minikube
   $ minikube version
4. **Install kubectl utility [amd64]**
   ```bash
   $ curl -LO https://storage.googleapis.com/kubernetes-release/release/"curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt"/bin/linux/amd64/kubectl
   $ chmod +x kubectl
   $ sudo mv kubectl /usr/local/bin/
   $ kubectl version -short
5. Start Minikube
   ```bash
   $ minikube start â€” driver=docker
   $ minikube status
   $ kubectl cluster-info
   $ minikube ip
6. **Install Ansible**
   ```bash
   apt install ansible
7. **Clone the Repository:**
   ```bash
   git clone https://github.com/swapnilraw15/AshnikAssignment.git
   cd  AshnikAssignment/
8. **Run the Playbook:**
   ```bash
   ansible-playbook helloworld.yml
This command will execute all the tasks in the playbook, deploying the Nginx Ingress controller and the "Hello World" application with TLS.

9. **Access the application:**
Go to local browser and run `http://<minikube-ip>:30007`
   
## Troubleshooting

### Error: permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.46/version": dial unix /var/run/docker.sock: connect: permission denied
   - This error occurs if your current user is not added in docker group.
   - Add your user to the Docker group: `sudo usermod -aG docker $USER` and run `newgrp docker`

### Error: `cannot re-use a name that is still in use`
   - This error occurs if a Helm release with the same name already exists. The playbook handles this by uninstalling the existing release before deploying a new one. If the problem persists, manually delete the Helm release using `helm delete <release-name>`.

### Error: `dial tcp <IP>:443: connect: connection refused`
   - This error typically indicates that the Nginx Ingress controller's admission webhook is not ready. The playbook includes retries for this step, but you may need to manually check the status of the Nginx Ingress controller using `kubectl get pods -n ingress-nginx` if the issue continues.
