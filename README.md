# Ansible Playbook: Deploy Nginx Ingress and Sample Application on Kubernetes

This Ansible playbook automates the deployment of an Nginx Ingress controller and a sample "Hello World" application on a Kubernetes cluster. The playbook also implements TLS termination using a self-signed certificate.

## Table of Contents
- [Requirements](#requirements)
- [Playbook Structure](#playbook-structure)
- [Usage](#usage)
- [Tasks Breakdown](#tasks-breakdown)
- [Troubleshooting](#troubleshooting)

## Requirements
- **Kubernetes Cluster:** Ensure you have a running Kubernetes cluster.
- **Ansible:** Installed on your local machine or control node.
- **kubectl and Helm:** Available on the machine running the playbook.
- **Access to the Kubernetes Cluster:** Ensure you have cluster admin privileges.

## Playbook Structure

- **`deploy_k8s.yml`:** The main playbook file containing all tasks.
- **`/tmp/hello-world-tls.yaml`:** Temporary manifest file generated by the playbook for deploying the sample application with TLS.

## Usage

1. Go to #https://killercoda.com/playgrounds/scenario/kubernetes [This will give empty k8s cluster for 60min]
2. **Install Ansible**
   ```bash
   apt install ansible
3. **Clone the Repository:**
   ```bash
   git clone https://github.com/swapnilraw15/AshnikAssignment.git
   cd  AshnikAssignment/
4. **Run the Playbook:**
   ```bash
   ansible-playbook deploy_k8s.yml
This command will execute all the tasks in the playbook, deploying the Nginx Ingress controller and the "Hello World" application with TLS.
5. **Access the application**
   Click on hamburger on right top and go to traffic/ports
   Access application using port 30007

## Tasks Breakdown

### 1. Install Helm if not installed
   - Checks if Helm is installed on the control node. If not, it installs Helm.

### 2. Add the Ingress-Nginx Helm Repo
   - Adds the official Nginx Ingress Helm repository to the control node.

### 3. Uninstall Existing Nginx Ingress Release (If Exists)
   - Ensures there is no conflict by removing any existing Nginx Ingress Helm release.

### 4. Install Nginx Ingress Controller
   - Deploys the Nginx Ingress controller in the `ingress-nginx` namespace using Helm.

### 5. Generate Self-Signed TLS Certificate
   - Uses OpenSSL to generate a self-signed TLS certificate and key.

### 6. Create Kubernetes Secret for TLS
   - Creates a Kubernetes secret named `hello-world-tls` to store the TLS certificate and key.

### 7. Ensure Nginx Ingress Controller and Webhook are Running
   - Verifies that the Nginx Ingress controller and its admission webhook are running and ready.

### 8. Create and Apply Kubernetes Manifest
   - Generates a Kubernetes manifest for the "Hello World" application, including the Ingress resource with TLS, and applies it to the cluster.


## Troubleshooting

### Error: `cannot re-use a name that is still in use`
   - This error occurs if a Helm release with the same name already exists. The playbook handles this by uninstalling the existing release before deploying a new one. If the problem persists, manually delete the Helm release using `helm delete <release-name>`.

### Error: `dial tcp <IP>:443: connect: connection refused`
   - This error typically indicates that the Nginx Ingress controller's admission webhook is not ready. The playbook includes retries for this step, but you may need to manually check the status of the Nginx Ingress controller using `kubectl get pods -n ingress-nginx` if the issue continues.

### Certificate Issues
   - Ensure that the self-signed certificate is correctly generated and applied as a Kubernetes secret. You can verify this by checking the secrets in the Kubernetes cluster using `kubectl get secrets -n default` and inspecting the secret details with `kubectl describe secret hello-world-tls -n default`.
